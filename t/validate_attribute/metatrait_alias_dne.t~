use strict;
use warnings;

use Test::Builder::Tester;
use Test::More;
use Test::Moose::More;
use TAP::SimpleOutput 0.002 'counters';

{
    package TestClass;
    use Moose;
    use namespace::autoclean;

    has thinger => (is => 'ro', predicate => 'has_thinger');
}
{
    package TestRole;
    use Moose::Role;
    use namespace::autoclean;

    has thinger => (is => 'ro', predicate => 'has_thinger');
}

subtest 'a standalone run of validate_attribute' => sub {

    validate_attribute TestClass => thinger => (
        -does => [ 'AliasThatHopefullyDNE' ],
    );
};

{
    note my $test_title = '';
    my ($_ok, $_nok, $_skip, $_todo, $_other) = counters();
    test_out $_ok->('TestClass has an attribute named thinger');
    test_out $_ok->('Moose::Meta::Attribute has a metaclass');
    test_out $_ok->('Moose::Meta::Attribute is a Moose class');
    validate_attribute TestClass => thinger => (
        -does => [ 'AliasThatHopefullyDNE' ],
    );
    test_test $test_title;
}

done_testing;
__END__

{
    note my $test_title = 'validate_attribute() for an invalid role attribute';
    my ($_ok, $_nok, $_skip, $_todo, $_other) = counters();
    test_out $_nok->('TestRole has an attribute named dne');
    test_fail 1;
    validate_attribute TestRole => dne => (
        reader    => 'dne',
        predicate => 'has_dne',
    );
    test_test $test_title;
}

done_testing;
